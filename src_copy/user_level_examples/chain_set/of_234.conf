
/* 
* Title: chain_5.conf
* Description: chain #5 is the complex chain example.
*/

flow traffic_2 = [{'dst_ip' : '1.0.1.9'}, {'src_ip' : '1.0.1.1'}]
flow traffic_3 = [{'dst_ip' : '1.0.1.8'}, {'src_ip' : '1.0.1.1'}]
flow traffic_4 = [{'dst_ip' : '1.0.1.5'}, {'dst_ip' : '1.0.1.6'}, {'dst_ip' : '1.0.1.7'}]


argu0 = "ext_addrs=[{'ext_addr': '10.0.0.7'}]"

chain sp_3 = EVPAESCBC()->BPF() -> [ {'flowspec':[{'dst_ip': '1.0.1.7'}], 'nfchain' : NAT(argu0)}, {'flowspec':[{'dst_ip': '1.0.1.8'}], 'nfchain': NAT(argu0)}, {'flowspec':[{'dst_ip': '1.0.1.9'}], 'nfchain': NAT(argu0)}]  -> IPv4Forward()

argu1 = "rules=[{'src_ip': '10.0.0.8/16', 'drop': False}]"
argu2 = "rules=[{'src_ip': '10.0.0.10/16', 'drop': False}]"

chain main = DEDUP() -> ACL(argu1) -> TrafficShaper -> SilkRoad -> IPv4Forward

chain sub1 = SilkRoad() -> TrafficShaper() -> ACL(argu2)
chain sub2 = SilkRoad() -> TrafficShaper() -> ACL(argu2)
chain sub3 = SilkRoad() -> TrafficShaper() -> ACL(argu2)
chain sp_4 = DEDUP() -> ACL(argu2) -> Measure() -> VLANPush() -> BPF() -> [{'flowspec':[{'dst_ip': '1.0.1.10'}], 'nfchain': sub1}, {'flowspec':[{'dst_ip': '1.0.1.11'}], 'nfchain': sub2}, {'flowspec':[{'dst_ip': '1.0.1.12'}], 'nfchain': sub3} ] -> IPv4Forward()

traffic_2 : sp_3
traffic_3 : main
traffic_4: sp_4
